<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026 Stats Tracker</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>

  <h1>2026 Stats Tracker</h1>

  <div id="loginDiv">
    <h2>Login</h2>
    <input id="user" placeholder="Username"><br>
    <input id="password" type="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <p id="loginMsg" class="error-msg"></p>
  </div>

  <div id="trackerDiv" style="display:none">
    <h2 id="welcome"></h2>

    <div class="container">
      <!-- LEFT SIDE: ADD STATS -->
      <div class="left">
        <div class="section">
          <h3>Add Counters</h3>
          <button onclick="increment('piss')">+ Piss</button>
          <button onclick="increment('poop')">+ Poop</button>
          <button onclick="increment('coffee')">+ Coffee</button>
          <button onclick="toggle('sick')">Toggle Sick</button>
          <button onclick="toggle('workout')">Toggle Workout</button>
          <button onclick="toggle('nap')">Toggle Nap</button>
          <button onclick="toggle('party')">Toggle Party</button>
        </div>

        <div class="section">
          <h3>Add Named Events</h3>
          <input id="restaurantName" placeholder="Restaurant">
          <button onclick="addNamed('restaurants','restaurantName')">Add Restaurant</button>
          <input id="filmName" placeholder="Film">
          <button onclick="addNamed('films','filmName')">Add Film</button>
          <input id="showName" placeholder="TV Show">
          <button onclick="addNamed('shows','showName')">Add Show</button>
          <input id="bookName" placeholder="Book">
          <button onclick="addNamed('books','bookName')">Add Book</button>
        </div>
      </div>

      <!-- RIGHT SIDE: DAILY STATS -->
      <div class="right">
        <h3>Daily Stats</h3>
        <div id="statsCounters"></div>
        <div id="statsNamed"></div>
      </div>
    </div>
  </div>

  <script>
    let currentUser = ''

    async function login() {
      const user = document.getElementById('user').value
      const password = document.getElementById('password').value
      const res = await fetch("/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user, password })
      })
      if (!res.ok) {
        document.getElementById('loginMsg').innerText = 'Invalid credentials'
        return
      }
      currentUser = user
      document.getElementById('loginDiv').style.display = 'none'
      document.getElementById('trackerDiv').style.display = 'block'
      document.getElementById('welcome').innerText = `Logged in as ${user.charAt(0).toUpperCase() + user.slice(1)}`
      updateState()
    }

    // fetch state and update summary
    async function updateState() {
      const res = await fetch(`/state/${currentUser}`)
      const state = await res.json()

      // Numeric counters
      const countersHtml = `
    <strong>Counters:</strong><br>
    Piss: ${state.piss}<br>
    Poop: ${state.poop}<br>
    Coffee: ${state.coffee}<br>
    Sick: ${state.sick}<br>
    Workout: ${state.workout}<br>
    Nap: ${state.nap}<br>
    Party: ${state.party}<br>
  `
      document.getElementById('statsCounters').innerHTML = countersHtml

      // Named events
      const namedHtml = `
    <strong>Named Events:</strong><br>
    Restaurants: ${state.restaurants.map(r => r.name).join(', ') || 'None'}<br>
    Films: ${state.films.map(f => f.name).join(', ') || 'None'}<br>
    TV Shows: ${state.shows.map(s => s.name).join(', ') || 'None'}<br>
    Books: ${state.books.map(r => r.name).join(', ') || 'None'}<br>
  `
      document.getElementById('statsNamed').innerHTML = namedHtml
    }

    // increment numeric field
    async function increment(field) {
      await fetch(`/increment/${currentUser}/${field}`, { method: 'POST' })
      updateState()
    }

    // toggle binary field
    async function toggle(field) {
      await fetch(`/toggle/${currentUser}/${field}`, { method: 'POST' })
      updateState()
    }

    // add named event
    async function addNamed(type, inputId) {
      const name = document.getElementById(inputId).value
      if (!name) return
      await fetch(`/add/${currentUser}/${type}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name })
      })
      document.getElementById(inputId).value = ''
      updateState()
    }
  </script>

</body>

</html>