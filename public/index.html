<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026 Stats Tracker</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>

<body>

  <h1>2026 Stats Tracker</h1>

  <div id="loginDiv">
    <h2>Login</h2>
    <input id="user" placeholder="Username"><br>
    <input id="password" type="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <p id="loginMsg" class="error-msg"></p>
  </div>

  <div id="trackerDiv" style="display:none">
    <h2 id="welcome"></h2>

    <div class="container">
      <!-- LEFT SIDE: ADD STATS -->
      <div class="left">
        <div class="section">
          <h3>Añadir Estadisticas</h3>
          <div class="counter-row">
            <button onclick="increment('piss')">+ Pis</button>
            <button class="decrement-btn" onclick="decrement('piss')">-</button>
          </div>
          <div class="counter-row">
            <button onclick="increment('poop')">+ Caca</button>
            <button class="decrement-btn" onclick="decrement('poop')">-</button>
          </div>
          <div class="counter-row">
            <button onclick="increment('shower')">+ Ducha</button>
            <button class="decrement-btn" onclick="decrement('shower')">-</button>
          </div>
          <div class="counter-row">
            <button onclick="increment('coffee')">+ Cafe</button>
            <button class="decrement-btn" onclick="decrement('coffee')">-</button>
          </div>
          <button onclick="toggle('sick')">Activar Enfermo</button>
          <button onclick="toggle('workout')">Activar Entrenamiento</button>
          <button onclick="toggle('nap')">Activar Siesta</button>
          <button onclick="toggle('party')">Activar Fiesta</button>
        </div>

        <div class="section">
          <h3>Añadir Eventos</h3>
          <input id="restaurantName" placeholder="Restaurante">
          <button onclick="addNamed('restaurants','restaurantName')">Añadir Restaurante</button>
          <input id="filmName" placeholder="Pelicula">
          <button onclick="addNamed('films','filmName')">Añadir Pelicula</button>
          <input id="showName" placeholder="Serie">
          <button onclick="addNamed('shows','showName')">Añadir Serie</button>
          <input id="bookName" placeholder="Libro">
          <button onclick="addNamed('books','bookName')">Añadir Libro</button>
        </div>
      </div>

      <!-- RIGHT SIDE: DAILY STATS -->
      <div class="right">
        <h3> Estadisticas Diarias <span id="date">today</span></h3>
        <div id="statsCounters"></div>
        <div id="statsNamed"></div>
      </div>
    </div>
  </div>

  <script>
    let currentUser = ''

    async function login() {
      const user = document.getElementById('user').value
      const password = document.getElementById('password').value
      const res = await fetch("/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ user, password })
      })
      if (!res.ok) {
        document.getElementById('loginMsg').innerText = 'Invalid credentials'
        return
      }
      currentUser = user
      document.getElementById('loginDiv').style.display = 'none'
      document.getElementById('trackerDiv').style.display = 'block'
      document.getElementById('welcome').innerText = `Sesion iniciada como ${user.charAt(0).toUpperCase() + user.slice(1)}`
      updateState()
    }

    // fetch state and update summary
    async function updateState() {
      const res = await fetch(`/state/${currentUser}`)
      const state = await res.json()

      // Numeric counters
      document.getElementById('date').innerText = `(${state.date})`
      const countersHtml = `
    <strong>Contadores:</strong><br>
    Pis: ${state.piss}<br>
    Cacas: ${state.poop}<br>
    Ducha: ${state.shower}<br>
    Cafe: ${state.coffee}<br>
    Enfermo: ${state.sick}<br>
    Entrenamiento: ${state.workout}<br>
    Siesta: ${state.nap}<br>
    Fiesta: ${state.party}<br>
  `
      document.getElementById('statsCounters').innerHTML = countersHtml

      // Named events
      const namedHtml = `
    <strong>Eventos:</strong><br>
    Restaurantes: ${state.restaurants.map(r => r.name).join(', ') || 'None'}<br>
    Peliculas: ${state.films.map(f => f.name).join(', ') || 'None'}<br>
    Series: ${state.shows.map(s => s.name).join(', ') || 'None'}<br>
    Libros: ${state.books.map(r => r.name).join(', ') || 'None'}<br>
  `
      document.getElementById('statsNamed').innerHTML = namedHtml
    }

    // increment numeric field
    async function increment(field) {
      await fetch(`/increment/${currentUser}/${field}`, { method: 'POST' })
      updateState()
    }

    async function decrement(field) {
      await fetch(`/decrement/${currentUser}/${field}`, { method: 'POST' })
      updateState()
    }

    // toggle binary field
    async function toggle(field) {
      await fetch(`/toggle/${currentUser}/${field}`, { method: 'POST' })
      updateState()
    }

    // add named event
    async function addNamed(type, inputId) {
      const name = document.getElementById(inputId).value
      if (!name) return
      await fetch(`/add/${currentUser}/${type}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name })
      })
      document.getElementById(inputId).value = ''
      updateState()
    }
  </script>

</body>

</html>